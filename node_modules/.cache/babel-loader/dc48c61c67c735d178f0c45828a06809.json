{"ast":null,"code":"export class AbstractRequestApi {\n  constructor() {\n    this.defaultHeader = {\n      Accept: 'application/json',\n      'Content-Type': 'application/json',\n      'Access-Control-Allow-Origin': '*'\n    };\n  }\n\n  async _makeRequest(url, method, body, headers) {\n    const newHeaders = this._addHeader(headers);\n\n    try {\n      const response = await this.timeoutWrapper(this.getTimeout(), fetch(url, {\n        headers: newHeaders,\n        body: JSON.stringify(body),\n        method\n      }));\n\n      if (!response.ok) {\n        const errorMsg = await response.json();\n        throw new Error(errorMsg);\n      }\n\n      return response.json().then(data => this.checkForErrorData(data));\n    } catch (error) {\n      console.log(error);\n      throw new Error(error);\n    }\n  }\n\n  getTimeout() {\n    return 50000;\n  }\n\n  checkForErrorData(data) {\n    if (data.errors) {\n      return Promise.reject(new Error(data.errors));\n    }\n\n    return data;\n  }\n\n  _addHeader(optionalHeaders) {\n    const headers = this.defaultHeader;\n\n    if (optionalHeaders) {\n      Object.keys(optionalHeaders).forEach(key => headers[key] = optionalHeaders[key]);\n    }\n\n    return headers;\n  }\n\n  timeoutWrapper(millis, promise) {\n    return new Promise((resolve, reject) => {\n      const timeoutId = setTimeout(() => {\n        reject(new Error(\"Error\"));\n      }, millis);\n      promise.then(res => {\n        clearTimeout(timeoutId);\n        resolve(res);\n      }, err => {\n        clearTimeout(timeoutId);\n        reject(err);\n      });\n    });\n  }\n\n}","map":{"version":3,"sources":["/Users/ffaiku/opt/FH/4 Semester/Verteilte Systeme/Project/smart-home-ui/smart-home-ui/src/api/makeRequest.tsx"],"names":["AbstractRequestApi","defaultHeader","Accept","_makeRequest","url","method","body","headers","newHeaders","_addHeader","response","timeoutWrapper","getTimeout","fetch","JSON","stringify","ok","errorMsg","json","Error","then","data","checkForErrorData","error","console","log","errors","Promise","reject","optionalHeaders","Object","keys","forEach","key","millis","promise","resolve","timeoutId","setTimeout","res","clearTimeout","err"],"mappings":"AAEA,OAAO,MAAMA,kBAAN,CAAyB;AAAA;AAAA,SAE9BC,aAF8B,GAEd;AACdC,MAAAA,MAAM,EAAE,kBADM;AAEd,sBAAgB,kBAFF;AAGd,qCAA+B;AAHjB,KAFc;AAAA;;AAQ9B,QAAMC,YAAN,CAAuBC,GAAvB,EAAoCC,MAApC,EAAoDC,IAApD,EAAgEC,OAAhE,EAA2F;AACzF,UAAMC,UAAU,GAAG,KAAKC,UAAL,CAAgBF,OAAhB,CAAnB;;AAEA,QAAI;AACF,YAAMG,QAAQ,GAAG,MAAM,KAAKC,cAAL,CACrB,KAAKC,UAAL,EADqB,EAErBC,KAAK,CAACT,GAAD,EAAM;AACTG,QAAAA,OAAO,EAAEC,UADA;AAETF,QAAAA,IAAI,EAAEQ,IAAI,CAACC,SAAL,CAAeT,IAAf,CAFG;AAGTD,QAAAA;AAHS,OAAN,CAFgB,CAAvB;;AASA,UAAI,CAACK,QAAQ,CAACM,EAAd,EAAkB;AAChB,cAAMC,QAAgB,GAAG,MAAMP,QAAQ,CAACQ,IAAT,EAA/B;AACA,cAAM,IAAIC,KAAJ,CAAUF,QAAV,CAAN;AACD;;AACD,aAAOP,QAAQ,CAACQ,IAAT,GAAgBE,IAAhB,CAAsBC,IAAD,IAAe,KAAKC,iBAAL,CAAuBD,IAAvB,CAApC,CAAP;AACD,KAfD,CAeE,OAAOE,KAAP,EAAc;AACdC,MAAAA,OAAO,CAACC,GAAR,CAAYF,KAAZ;AACA,YAAM,IAAIJ,KAAJ,CAAUI,KAAV,CAAN;AACD;AACF;;AAEDX,EAAAA,UAAU,GAAW;AACnB,WAAO,KAAP;AACD;;AAEDU,EAAAA,iBAAiB,CAACD,IAAD,EAAY;AAC3B,QAAIA,IAAI,CAACK,MAAT,EAAiB;AACf,aAAOC,OAAO,CAACC,MAAR,CAAe,IAAIT,KAAJ,CAAUE,IAAI,CAACK,MAAf,CAAf,CAAP;AACD;;AACD,WAAOL,IAAP;AACD;;AAEDZ,EAAAA,UAAU,CAACoB,eAAD,EAAkC;AAC1C,UAAMtB,OAAO,GAAG,KAAKN,aAArB;;AAEA,QAAI4B,eAAJ,EAAqB;AACnBC,MAAAA,MAAM,CAACC,IAAP,CAAYF,eAAZ,EAA6BG,OAA7B,CAAqCC,GAAG,IAAK1B,OAAO,CAAC0B,GAAD,CAAP,GAAeJ,eAAe,CAACI,GAAD,CAA3E;AACD;;AACD,WAAO1B,OAAP;AACD;;AAGDI,EAAAA,cAAc,CAACuB,MAAD,EAAiBC,OAAjB,EAAwC;AACpD,WAAO,IAAIR,OAAJ,CAAY,CAACS,OAAD,EAAUR,MAAV,KAAqB;AACtC,YAAMS,SAAS,GAAGC,UAAU,CAAC,MAAM;AACjCV,QAAAA,MAAM,CAAC,IAAIT,KAAJ,CAAU,OAAV,CAAD,CAAN;AACD,OAF2B,EAEzBe,MAFyB,CAA5B;AAGAC,MAAAA,OAAO,CAACf,IAAR,CACEmB,GAAG,IAAI;AACLC,QAAAA,YAAY,CAACH,SAAD,CAAZ;AACAD,QAAAA,OAAO,CAACG,GAAD,CAAP;AACD,OAJH,EAKEE,GAAG,IAAI;AACLD,QAAAA,YAAY,CAACH,SAAD,CAAZ;AACAT,QAAAA,MAAM,CAACa,GAAD,CAAN;AACD,OARH;AAUD,KAdM,CAAP;AAeD;;AArE6B","sourcesContent":["import { Method } from './ApiMethodEnum';\n\nexport class AbstractRequestApi {\n\n  defaultHeader = {\n    Accept: 'application/json',\n    'Content-Type': 'application/json',\n    'Access-Control-Allow-Origin': '*',\n  };\n\n  async _makeRequest<T>( url: string, method: Method, body?: any, headers?: any): Promise<T> {\n    const newHeaders = this._addHeader(headers);\n\n    try {\n      const response = await this.timeoutWrapper(\n        this.getTimeout(),\n        fetch(url, {\n          headers: newHeaders,\n          body: JSON.stringify(body),\n          method,\n        })\n      );\n\n      if (!response.ok) {\n        const errorMsg: string = await response.json();\n        throw new Error(errorMsg);\n      }\n      return response.json().then((data: any) => this.checkForErrorData(data));\n    } catch (error) {\n      console.log(error);\n      throw new Error(error);\n    }\n  }\n\n  getTimeout(): number {\n    return 50000;\n  }\n\n  checkForErrorData(data: any) {\n    if (data.errors) {\n      return Promise.reject(new Error(data.errors));\n    }\n    return data;\n  }\n\n  _addHeader(optionalHeaders?: string[]): any {\n    const headers = this.defaultHeader;\n\n    if (optionalHeaders) {\n      Object.keys(optionalHeaders).forEach(key => (headers[key] = optionalHeaders[key]));\n    }\n    return headers;\n  }\n\n\n  timeoutWrapper(millis: number, promise): Promise<any> {\n    return new Promise((resolve, reject) => {\n      const timeoutId = setTimeout(() => {\n        reject(new Error(\"Error\"));\n      }, millis);\n      promise.then(\n        res => {\n          clearTimeout(timeoutId);\n          resolve(res);\n        },\n        err => {\n          clearTimeout(timeoutId);\n          reject(err);\n        }\n      );\n    });\n  }\n}\n"]},"metadata":{},"sourceType":"module"}